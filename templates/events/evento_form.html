{% extends "base.html" %}
{% block content %}
<h3>{{ 'Nuevo evento' if modo=='nuevo' else 'Editar evento' }}</h3>

<!-- Mensaje informativo -->
<div class="alert alert-info">
  <strong> Informaci贸n importante:</strong>
  <ul class="mb-0 mt-2">
    <li>Para eventos <strong>virtuales</strong>: Completa el <strong>enlace virtual</strong></li>
    <li>Para eventos <strong>presenciales</strong>: Completa <strong>lugar y ciudad</strong></li>
  </ul>
</div>

<form method="post" id="eventoForm">
  <div class="row g-3">
    <!-- Campos b谩sicos del evento -->
    <div class="col-md-6">
      <label class="form-label">Nombre</label>
      <input name="nombre" class="form-control" value="{{ ev.nombre if ev else '' }}" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Tipo</label>
      <select name="tipo_evento" class="form-select">
        {% for t in tipos %}
          <option value="{{t}}" {% if ev and ev.tipo_evento==t %}selected{% endif %}>{{t}}</option>
        {% endfor %}
      </select>
    </div>
    
    <!-- Fechas -->
    <div class="col-md-6">
      <label class="form-label">Fecha inicio</label>
      <input type="date" name="fecha_inicio" class="form-control"
            value="{{ ev.fecha_inicio.strftime('%Y-%m-%d') if ev and ev.fecha_inicio else '' }}" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Fecha fin</label>
      <input type="date" name="fecha_fin" class="form-control"
            value="{{ ev.fecha_fin.strftime('%Y-%m-%d') if ev and ev.fecha_fin else '' }}" required>
    </div>
    
    <!-- Horarios diarios -->
    <div class="col-md-6">
      <label class="form-label">Hora inicio diaria</label>
      <input type="time" name="hora_inicio_diaria" class="form-control"
            value="{% if ev %}{{ ev.hora_inicio_diaria|format_time('09:00') }}{% else %}09:00{% endif %}" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Hora fin diaria</label>
      <input type="time" name="hora_fin_diaria" class="form-control"
            value="{% if ev %}{{ ev.hora_fin_diaria|format_time('17:00') }}{% else %}17:00{% endif %}" required>
    </div>
    
    <!-- Selecci贸n de modalidad -->
    <div class="col-md-6">
      <label class="form-label">Modalidad <span class="text-danger">*</span></label>
      <select name="modalidad" class="form-select" required>
        <option value="">Selecciona una modalidad</option>
        <option value="presencial" {% if ev and ev.modalidad=='presencial' %}selected{% endif %}>
          Presencial
        </option>
        <option value="virtual" {% if ev and ev.modalidad=='virtual' %}selected{% endif %}>
          Virtual
        </option>
      </select>
    </div>
    
    <!-- Cupo m谩ximo -->
    <div class="col-md-6">
      <label class="form-label">Cupo m谩ximo</label>
      <input type="number" min="1" name="cupo_maximo" class="form-control"
            value="{{ ev.cupo_maximo if ev else 10 }}" required>
    </div>
    
    <!-- Campos para modalidad VIRTUAL -->
    <div class="col-12 virtual-fields" 
         style="{% if ev and ev.modalidad != 'virtual' %}display: none;{% endif %}">
      <div class="card border-primary">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-video me-2"></i>Configuraci贸n para Evento Virtual
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <label class="form-label">Enlace de la sesi贸n virtual <span class="text-danger">*</span></label>
              <input type="url" name="enlace_virtual" class="form-control" 
                     value="{{ ev.enlace_virtual if ev else '' }}"
                     placeholder="https://meet.google.com/xxx-xxxx-xxx o https://zoom.us/j/..."
                     {% if ev and ev.modalidad == 'virtual' %}required{% endif %}>
              <div class="form-text">Este enlace se enviar谩 por correo a los participantes inscritos.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Campos para modalidad PRESENCIAL -->
    <div class="col-12 presencial-fields"
         style="{% if ev and ev.modalidad == 'virtual' %}display: none;{% endif %}">
      <div class="card border-warning">
        <div class="card-header bg-warning text-dark">
          <i class="fas fa-map-marker-alt me-2"></i>Configuraci贸n para Evento Presencial
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <label class="form-label">Lugar <span class="text-danger">*</span></label>
              <input name="lugar" class="form-control" value="{{ ev.lugar if ev else '' }}"
                     {% if ev and ev.modalidad != 'virtual' %}required{% endif %}>
              <div class="form-text">Ej: Auditorio principal, Sala de conferencias, etc.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Ciudad <span class="text-danger">*</span></label>
              <input name="ciudad" class="form-control" value="{{ ev.ciudad if ev else '' }}"
                     {% if ev and ev.modalidad != 'virtual' %}required{% endif %}>
              <div class="form-text">Ciudad donde se realizar谩 el evento</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Descripci贸n del evento -->
  <div class="mt-3">
    <label class="form-label">Descripci贸n</label>
    <textarea name="descripcion" class="form-control" rows="5">{{ ev.descripcion if ev else '' }}</textarea>
  </div>
  
  <!-- Botones de acci贸n -->
  <div class="mt-3 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Guardar</button>
    <a class="btn btn-secondary" href="{{ url_for('eventos.eventos_list') }}">Volver</a>
  </div>
</form>

<style>
.virtual-fields, .presencial-fields {
  transition: all 0.3s ease;
}
.card-header {
  font-weight: 600;
}
.form-text {
  font-size: 0.875em;
  color: #6c757d;
}
</style>
{% endblock %}